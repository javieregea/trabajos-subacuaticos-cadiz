---
// Header component
import Logo from './Logo.astro';

// Detectar si estamos en la home
const isHome = Astro.url.pathname === '/' || Astro.url.pathname === '/index.html';

// Clase para header fijo solo en home mobile
const headerClass = isHome
  ? "bg-blue-900 text-white shadow-lg fixed top-0 left-0 right-0 z-50 transition-all duration-300 home-header"
  : "bg-blue-900 text-white shadow-lg md:fixed md:top-0 md:left-0 md:right-0 z-50 transition-all duration-300";
---

<header class={headerClass} id="main-header">
  <nav class="container mx-auto px-3 md:px-4 py-1 md:py-2">
    <div class="flex items-center justify-between">
      <!-- Logo -->
      <a href="/" class="flex items-center hover:opacity-90 transition-opacity flex-shrink-0">
        <Logo size="small" className="header-logo w-24 sm:w-28 md:w-36 lg:w-40" />
      </a>

      <!-- Navigation -->
      <div class="hidden md:flex space-x-4 lg:space-x-6 text-sm">
        <a href="/" class="hover:text-blue-200 transition-colors">Inicio</a>
        <a href="/servicios" class="hover:text-blue-200 transition-colors">Servicios</a>
        <a href="/soldadura-subacuatica" class="hover:text-blue-200 transition-colors hidden lg:inline">Soldadura Subacuática</a>
        <a href="/blog" class="hover:text-blue-200 transition-colors">Blog</a>
        <a href="/emergencias" class="hover:text-blue-200 transition-colors">Emergencias</a>
        <a href="/contacto" class="hover:text-blue-200 transition-colors">Contacto</a>
      </div>

      <!-- Emergency Contact -->
      <a href="tel:+34614405061" class="hidden lg:flex items-center space-x-2 bg-red-700 hover:bg-red-800 px-3 py-2 rounded-lg transition-colors shadow-lg pulse-effect">
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
        </svg>
        <div class="text-xs">
          <div class="font-semibold">Emergencia</div>
          <div>614 405 061</div>
        </div>
      </a>

      <!-- Mobile CTA and menu -->
      <div class="md:hidden flex items-center space-x-1">
        <a href="tel:+34614405061" class="bg-red-700 hover:bg-red-800 px-2 py-1.5 rounded text-xs font-semibold transition-colors flex items-center space-x-1 pulse-effect shadow-md">
          <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
            <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
          </svg>
          <span class="hidden xs:inline">Llamar</span>
        </a>
        <button class="p-1" onclick="toggleMobileMenu()">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Navigation -->
    <div id="mobile-menu" class="md:hidden mt-2 space-y-1 hidden bg-blue-100 rounded-lg p-2 shadow-lg">
      <a href="/" class="block py-1.5 text-blue-900 hover:text-blue-600 border-b border-blue-200 last:border-b-0 font-medium text-sm">Inicio</a>
      <a href="/servicios" class="block py-1.5 text-blue-900 hover:text-blue-600 border-b border-blue-200 last:border-b-0 font-medium text-sm">Servicios</a>
      <a href="/soldadura-subacuatica" class="block py-1.5 text-blue-900 hover:text-blue-600 border-b border-blue-200 last:border-b-0 font-medium text-sm">Soldadura Subacuática</a>
      <a href="/blog" class="block py-1.5 text-blue-900 hover:text-blue-600 border-b border-blue-200 last:border-b-0 font-medium text-sm">Blog</a>
      <a href="/emergencias" class="block py-1.5 text-blue-900 hover:text-blue-600 border-b border-blue-200 last:border-b-0 font-medium text-sm">Emergencias 24h</a>
      <a href="/contacto" class="block py-1.5 text-blue-900 hover:text-blue-600 font-medium text-sm">Contacto</a>
    </div>
  </nav>
</header>

<script>
  function toggleMobileMenu() {
    const menu = document.getElementById('mobile-menu');
    const button = document.querySelector('button[onclick="toggleMobileMenu()"]');

    if (menu) {
      menu.classList.toggle('hidden');

      // Toggle hamburger to X animation
      const svg = button?.querySelector('svg');
      if (svg) {
        const isOpen = !menu.classList.contains('hidden');
        svg.innerHTML = isOpen ?
          '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>' :
          '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>';
      }
    }
  }

  // Ensure script runs after DOM is loaded
  document.addEventListener('DOMContentLoaded', function() {
    // Add click event listener as backup
    const menuButton = document.querySelector('button[onclick="toggleMobileMenu()"]');
    if (menuButton) {
      menuButton.addEventListener('click', function(e) {
        e.preventDefault();
        toggleMobileMenu();
      });
    }

    // Header scroll behavior - make compact on scroll
    let lastScrollTop = 0;
    const header = document.getElementById('main-header');
    const nav = header.querySelector('nav');

    window.addEventListener('scroll', function() {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

      if (scrollTop > 50) {
        header.classList.add('scrolled');
        nav.classList.remove('py-2');
        nav.classList.add('py-1');
      } else {
        header.classList.remove('scrolled');
        nav.classList.remove('py-1');
        nav.classList.add('py-2');
      }

      lastScrollTop = scrollTop;
    });
  });
</script>

<style>
  /* Pulse effect for emergency buttons */
  .pulse-effect {
    animation: pulse-red 2s infinite;
  }

  @keyframes pulse-red {
    0% {
      box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
    }
    70% {
      box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
    }
    100% {
      box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
    }
  }

  /* Header scrolled state */
  #main-header.scrolled {
    background: rgba(30, 58, 138, 0.95);
    backdrop-filter: blur(10px);
    box-shadow: 0 2px 20px rgba(0, 0, 0, 0.2);
  }

  #main-header.scrolled .pulse-effect {
    background: #b91c1c !important;
  }

  #main-header.scrolled .pulse-effect:hover {
    background: #991b1b !important;
  }

  /* Logo gradient animation */
  .logo-gradient {
    background: linear-gradient(45deg, #dc2626, #ef4444);
    background-size: 200% 200%;
    animation: gradientShift 3s ease infinite;
  }

  @keyframes gradientShift {
    0%, 100% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
  }

  /* Mobile responsive improvements */
  @media (max-width: 768px) {
    #main-header nav {
      padding-top: 0.375rem;
      padding-bottom: 0.375rem;
    }

    #main-header.scrolled nav {
      padding-top: 0.25rem;
      padding-bottom: 0.25rem;
    }

    .header-logo {
      max-height: 32px;
    }

    /* Solo en páginas que NO son home: remover fixed y agregar padding al body */
    #main-header:not(.home-header) {
      position: relative;
    }

    /* En home: header fixed, agregar padding al body */
    body:has(#main-header.home-header) {
      padding-top: 60px;
    }
  }

  @media (max-width: 640px) {
    #main-header nav {
      padding-top: 0.25rem;
      padding-bottom: 0.25rem;
    }

    .header-logo {
      max-height: 28px;
    }

    body:has(#main-header.home-header) {
      padding-top: 56px;
    }
  }
</style>